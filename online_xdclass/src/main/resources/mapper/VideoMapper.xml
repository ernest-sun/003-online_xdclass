<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.xdclass.online_xdclass.mapper.VideoMapper">

  <!-- 通用查询映射结果 -->
  <resultMap id="BaseResultMap" type="net.xdclass.online_xdclass.model.Video">
    <id column="id" property="id"/>
    <result column="title" property="title"/>
    <result column="summary" property="summary"/>
    <result column="cover_img" property="coverImg"/>
    <result column="price" property="price"/>
    <result column="create_time" property="createTime"/>
    <result column="point" property="point"/>
  </resultMap>

  <!-- 通用查询结果列 -->
  <sql id="Base_Column_List">
    id
    , title, summary, cover_img, price, create_time, point
  </sql>

  <select id="listVideo" resultType="map">
    select id,
           title,
           summary,
           cover_img,
           price,
           if(create_time, DATE_FORMAT(create_time, '%Y-%m-%d %H:%i:%S'), null) as create_time,
           point
    from video;
  </select>

  <select id="listBanner" resultType="map">
    select id,
           url,
           img,
           if(create_time, DATE_FORMAT(create_time, '%Y-%m-%d %H:%i:%S'), null) as create_time,
           weight
    from video_banner
    order by weight asc;
  </select>

  <select id="findDetailById" resultType="map">
    select v.id,
           v.title,
           v.summary,
           v.cover_img,
           v.price,
           v.point,
           if(v.create_time, DATE_FORMAT(v.create_time, '%Y-%m-%d %H:%i:%S'), null) as create_time,
           c.id                                                                     as chapter_id,
           c.title                                                                  as chapter_title,
           c.ordered,
           if(c.create_time, DATE_FORMAT(c.create_time, '%Y-%m-%d %H:%i:%S'),
              null)                                                                 as chapter_creater_time,
           e.id                                                                     as episode_id,
           e.num,
           e.title                                                                  as episode_title,
           e.ordered                                                                as episode_ordered,
           e.play_url,
           e.free,
           if(e.create_time, DATE_FORMAT(e.create_time, '%Y-%m-%d %H:%i:%S'),
              null)                                                                 as episode_create_time
    from video v
           left join chapter c on v.id = c.video_id
           left join episode e on c.id = e.chapter_id
    where v.id = #{videoId}
    order by c.ordered, e.num asc;
  </select>

  <select id="findById" resultType="video">
    select id,
           title,
           summary,
           cover_img,
           price,
           create_time,
           point
    from video
    where id = #{video_id}
  </select>

</mapper>
